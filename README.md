# django_sprint4

Репозиторий для 3-й части "Блогикума"

## Проект. Приложение «Блогикум». Часть 3. Доработка

Вам предстоит выполнить финальное задание: доделать проект Блогикум. Это задание объёмнее, чем все предыдущие; оно требует от вас большей самостоятельности.

### Подготовка к выполнению задания:

1. Клонируйте репозиторий **django_sprint4** на свой компьютер, в рабочую папку *Dev/*.
2. Скопируйте выполненное задание по проекту «Блогикум» *django_sprint3/blogicum/* в папку *django_sprint4/blogicum/*.
3. Разверните и активируйте виртуальное окружение в папке *Dev/django_sprint4/*, установите в него зависимости из *requirements.txt*.

После установки проекта должна получиться такая структура файлов:

```
Dev/
 └── django_sprint4/
     ├── .vscode/    Служебная папка редактора кода (опционально, скрытая)
     ├── .git/       Служебная информация Git (скрытая)
     ├── tests/             Тесты Практикума, проверяющие проект
     ├── venv/              Директория виртуального окружения
     ├── blogicum/          <-- Директория проекта
     |   ├── blog/
     |   ├── pages/
     |   ├── static/
     |   ├── templates/     <-- Перенесите новые шаблоны сюда 
     |   ├── blogicum/
     |   ├── db.sqlite3     Файл базы данных (может и не быть)
     |   └── manage.py      
     ├── .gitignore         Список файлов и папок, скрытых от отслеживания Git (скрытый) 
     ├── db.json            <-- Фикстуры для базы данных    
     ├── LICENSE            Лицензия   
     ├── pytest.ini         Конфигурация тестов Практикума
     ├── README.md          Описание проекта 
     ├── requirements.txt   Список зависимостей проекта
     └── setup.cfg          Настройки тестов Практикума 
```

### Дополнительные материалы

#### Шаблоны страниц

Для финальной версии проекта мы подготовили новую версию шаблонов всех страниц. Они уже свёрстаны и разложены по директориям приложений. В нужных местах шаблонов указаны соответствующие переменные контекста — они помогут вам выполнить задание. 

Папка с шаблонами находится в репозитории, перенесите её в нужное место проекта.

Не вносите изменения в шаблоны: они полностью готовы к работе.

#### Фикстуры

В репозитории проекта есть файл с дампом базы данных: *db.json*. Дамп содержит несколько постов; вы можете загрузить его в базу и посмотреть, как выглядит и работает наполненный сайт. 

Для выполнения задания его загружать не обязательно, это остаётся на ваше усмотрение.

### Задание

Вот перечень задач, которые вам нужно выполнить:

* **Кастомные страницы для ошибок.**

  Подключите к проекту и настройте кастомные страницы для ошибок 403 CSRF, 404 и 500. Шаблоны для этих страниц находятся в директории *templates/pages/*. 

* **Работа с пользователями.**

  Подключите к проекту пользователей:

  1. Подключите к проекту пути для работы с пользователями из `django.contrib.auth.urls`;
  2. Переопределите шаблоны для каждой подключённой страницы;
  3. Создайте страницу *auth/registration/* с формой для регистрации пользователей;
  4. Создайте страницу пользователя *profile/<username>/*. На ней должны отображаться:
      1. информация о пользователе (доступна всем посетителям);
      2. публикации пользователя (доступны всем посетителям);
      3. ссылка на страницу редактирования профиля для изменения имени, фамилии, логина и адреса электронной почты (доступна только залогиненному пользователю — хозяину аккаунта);
      4. ссылка на страницу изменения пароля (доступна только залогиненному пользователю — хозяину аккаунта);

  Переопределять встроенную модель пользователя не требуется.

* **Пагинация.**

  Подключите к проекту пагинацию и настройте вывод не более 10 публикаций

  * на главную страницу,
  * на страницу пользователя,
  * на страницу категории.

* **Изображения к постам.**

  Добавьте возможность прикреплять изображение к публикациям проекта. Если изображение добавлено, то оно должно отображаться в публикациях на

  * главной странице,
  * странице пользователя,
  * странице категории,
  * отдельной странице публикации.

* **Добавление новых публикаций.**

  У зарегистрированных пользователей должна быть возможность самостоятельно публиковать посты. Создайте страницу для публикации новых записей *posts/create/*: 

* Страница добавления публикации должна быть доступна только авторизованным пользователям.
* После валидации формы и добавления новой публикации пользователь должен быть перенаправлен на свою страницу *profile/<username>/*.
* Новые категории и местоположения может создавать только администратор сайта через панель администратора.
* Указав дату публикации «в будущем», можно создавать отложенные посты. Они должны стать доступны всем посетителям с момента, указанного в поле «Дата». Отложенные публикации должны быть доступны автору сразу же после отправки; автор должен видеть на своей странице все свои публикации, включая отложенные и снятые с публикации администратором.

* **Редактирование публикаций.**

  Добавьте страницу редактирования публикации с адресом *posts/<post_id>/edit/*.

  * Права на редактирование должны быть только у автора публикации. Остальные пользователи должны перенаправляться на страницу просмотра поста.
  * Для страницы редактирования поста должен применяться тот же HTML-шаблон, что и для страницы создания нового поста: *blog/create.html.*
  * После окончания редактирования пользователь должен переадресовываться на страницу отредактированной публикации.

* **Комментарии к публикациям.**

  Создайте систему комментирования записей. На странице поста под текстом записи должна выводиться форма для отправки комментария, а ниже — список комментариев.

  * Комментарии должны быть отсортированы по времени их публикации, «от старых к новым».
  * Комментировать публикации могут только авторизованные пользователи.
  * Авторы комментариев должны иметь возможность отредактировать собственные комментарии.
  * Для каждой публикации на 
    * главной странице,
    * странице пользователя,
    * странице категории

  нужно выводить количество комментариев.

  * Адрес для добавления комментария *posts/<post_id>/comment/*
  * Адрес для редактирования комментария *posts/<post_id>/edit_comment/<comment_id>/*

* **Удаление публикаций и комментариев.**

  Авторизованные пользователи должны иметь возможность удалять собственные публикации и комментарии. Перед удалением материала должна открываться подтверждающая страница, содержащая публикацию или комментарий. Для подтверждающей страницы не надо создавать отдельные шаблоны; для этого необходимо переиспользовать существующие шаблоны, необходимая логика в них уже присутствует.

  * Адрес для удаления публикации *posts/<post_id>/delete/*
  * Адрес для удаления комментария *posts/<post_id>/delete_comment/<comment_id>/*

* Новые статичные страницы.

  Обновите механизм создания и изменения статичных страниц в проекте, используя CBV. Адреса уже существующих статичных страниц не должны измениться.

* Отправка электронной почты.

  Подключать к проекту реальный почтовый сервер сейчас нет необходимости, поэтому подключите файловый бэкенд: все «отправленные» письма должны аккумулироваться в специальной директории проекта *sent_emails/*. Из репозитория проекта эту директорию стоит исключить.

**Для выполнения задания используйте view-функции (FBV), view-классы (CBV) или их микс.**

### Возможные проблемы при отправке проекта на проверку

## Проблемы общего характера

1. **Тесты локально проходят, а на платформе выдают ошибку.**
  * Убедитесь, что проект написан с использованием возможностей Python 3.10. Тесты также должны запускаться именно на этой версии Python.
  * Возможно, локальная версия тестов на вашем компьютере отличается от тестов на платформе (тесты на платформе периодически обновляют или вы, возможно, случайно изменили тесты локально).\
\
  Актуальные тесты всегда можно взять из аккаунта Яндекс Практикума:\
  https://github.com/yandex-praktikum/django_sprint4/
  
  * Проверьте, что в .gitignore не добавлены файлы, от которых зависит запуск проекта (например, *pytest.ini*).
  * Убедитесь, что все приложения проекта добавлены в `INSTALLED_APPS` в файле *settings.py*.
  * Убедитесь, что в репозитории есть все миграции.
  * Убедитесь, что все файлы с кодом проекта включены в коммит и попали в репозиторий. Не добавляйте в репозиторий папки *pip*, *venv*, *static/css*.
  * Проверьте регистр названий папок и файлов (Git может не увидеть изменение регистра имени файла или папок). Команда `git config core.ignorecase false` сделает Git чувствительным к регистру.
2. **Проект не загружается на платформу.**
  * Проверьте, не переименован ли репозиторий. Репозиторий этого задания должен называться *django_sprint4*.
  * Проверьте, что актуальная версия проекта находится в ветке master или *main*.
  * Если вы загружали проект ZIP-архивом — проблема может быть в том, что формат архива не соответствует формату GitHub. 
  Если архив не хочет загружаться на платформу — создайте архив средствами GitHub: в интерфейсе репозитория есть кнопка **Download ZIP**. Нажав на неё, вы получите архив, который загрузится на платформу без проблем. 
 
## Что делать, если в репозиторий попали лишние файлы:

Если в репозитории на удалённом сервере окажется что-то лишнее (например, папки виртуального окружения или служебные папки редактора кода), воспользуйтесь этим алгоритмом (на примере *.vscode*):

```
# Добавить папку в игнор-лист гита
# командой из корневой директории проекта Dev/django_sprint4/
echo '.vscode' >> .gitignore

# Удалить папку из списка отслеживаемых файлов (staging area).
git rm -r --cached .vscode

# Зафиксировать изменения в новом коммите.
git commit -m 'Директория .vscode добавлена в gitignore'

# Отправить изменения.
git push
```
